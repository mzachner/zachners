<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets">

<h:head>
	<title>Tic Tac Toe</title>
	<h:panelGroup rendered="false">
		<meta http-equiv="refresh" content="1" />
	</h:panelGroup>
	<style type="text/css">
.infoMessage {
	font-family: arial;
	font-size: 0.8em;
	color: green;
}

.gameButton {
	padding: 0;
	margin: 0;
	width: 50px;
	height: 50px;
	background-color: white;
	border: none;
}

.gameTable {
	border-collapse: collapse;
}

.gameTable td {
	padding: 0;
	margin: 0;
	border: medium solid black;
	vertical-align: middle;
	text-align: center;
	height: 50px;
	width: 50px;
}

.gameTable td.left {
	border-left: none;
}

.gameTable td.top {
	border-top: none;
}

.gameTable td.bottom {
	border-bottom: none;
}

.gameTable td.right {
	border-right: none;
}
</style>
</h:head>
<h:body>
	<div>
		<h:outputText value="#{ticTacToe.sessionId}" style="display:none" />
	</div>
	<h3>Tic Tac Toe</h3>

	<h:outputText value="Warte auf zweiten Spieler..."
		rendered="#{!ticTacToe.connectionEstablished}"
		styleClass="infoMessage" />
	<h:outputText value="Ihr Zug bitte..." 
		rendered="#{ticTacToe.connectionEstablished and !ticTacToe.spielBeendet and ticTacToe.myTurn}"
		styleClass="infoMessage" />
	<h:outputText value="Sie haben gewonnen" rendered="#{ticTacToe.winner}"
		styleClass="infoMessage" />
	<h:outputText value="Sie haben verloren" rendered="#{ticTacToe.looser}"
		styleClass="infoMessage" />
	<h:outputText value="Unentschieden"
		rendered="#{ticTacToe.unentschieden}" styleClass="infoMessage" />
	<br />
	<br />

	<h:form prependId="false">

		<table class="gameTable">
			<tr>
				<td class="left top">
					<h:commandButton
						value="#{ticTacToe.getFeldValue('0', '0')}"
						action="#{ticTacToe.doAction('0', '0')}"
						styleClass="gameButton #{ticTacToe.isWinnerButton('0', '0')}"
						rendered="#{ticTacToe.isNotDisabled('0', '0')}" />
						<h:panelGroup rendered="#{ticTacToe.getFeldValue('0', '0') == 'X'}">
							<ui:include src="x.svg" />
						</h:panelGroup>
						<h:panelGroup rendered="#{ticTacToe.getFeldValue('0', '0') == 'O'}">
							<ui:include src="o.svg" />
						</h:panelGroup>
					</td>
				<td class="top"> <h:commandButton
						value="#{ticTacToe.getFeldValue('0', '1')}"
						action="#{ticTacToe.doAction('0', '1')}"
						styleClass="gameButton #{ticTacToe.isWinnerButton('0', '1')}" 
						rendered="#{ticTacToe.isNotDisabled('0', '1')}" />
						<h:panelGroup rendered="#{ticTacToe.getFeldValue('0', '1') == 'X'}">
							<ui:include src="x.svg" />
						</h:panelGroup>
						<h:panelGroup rendered="#{ticTacToe.getFeldValue('0', '1') == 'O'}">
							<ui:include src="o.svg" />
						</h:panelGroup>
						</td>
				<td class="top right"><h:commandButton
						value="#{ticTacToe.getFeldValue('0', '2')}"
						action="#{ticTacToe.doAction('0', '2')}"
						styleClass="gameButton #{ticTacToe.isWinnerButton('0', '2')}" 
						rendered="#{ticTacToe.isNotDisabled('0', '2')}" />
						<h:panelGroup rendered="#{ticTacToe.getFeldValue('0', '2') == 'X'}">
							<ui:include src="x.svg" />
						</h:panelGroup>
						<h:panelGroup rendered="#{ticTacToe.getFeldValue('0', '2') == 'O'}">
							<ui:include src="o.svg" />
						</h:panelGroup>
						</td>
			</tr>
			<tr>
				<td class="left"><h:commandButton
						value="#{ticTacToe.getFeldValue('1', '0')}"
						action="#{ticTacToe.doAction('1', '0')}"
						styleClass="gameButton #{ticTacToe.isWinnerButton('1', '0')}" 
						rendered="#{ticTacToe.isNotDisabled('1', '0')}" />
						<h:panelGroup rendered="#{ticTacToe.getFeldValue('1', '0') == 'X'}">
							<ui:include src="x.svg" />
						</h:panelGroup>
						<h:panelGroup rendered="#{ticTacToe.getFeldValue('1', '0') == 'O'}">
							<ui:include src="o.svg" />
						</h:panelGroup>
						</td>
				<td><h:commandButton
						value="#{ticTacToe.getFeldValue('1', '1')}"
						action="#{ticTacToe.doAction('1', '1')}"
						styleClass="gameButton #{ticTacToe.isWinnerButton('1', '1')}" 
						rendered="#{ticTacToe.isNotDisabled('1', '1')}" />
						<h:panelGroup rendered="#{ticTacToe.getFeldValue('1', '1') == 'X'}">
							<ui:include src="x.svg" />
						</h:panelGroup>
						<h:panelGroup rendered="#{ticTacToe.getFeldValue('1', '1') == 'O'}">
							<ui:include src="o.svg" />
						</h:panelGroup>
						</td>
				<td class="right"><h:commandButton
						value="#{ticTacToe.getFeldValue('1', '2')}"
						action="#{ticTacToe.doAction('1', '2')}"
						styleClass="gameButton #{ticTacToe.isWinnerButton('1', '2')}" 
						rendered="#{ticTacToe.isNotDisabled('1', '2')}" />
						<h:panelGroup rendered="#{ticTacToe.getFeldValue('1', '2') == 'X'}">
							<ui:include src="x.svg" />
						</h:panelGroup>
						<h:panelGroup rendered="#{ticTacToe.getFeldValue('1', '2') == 'O'}">
							<ui:include src="o.svg" />
						</h:panelGroup>
						</td>
			</tr>
			<tr>
				<td class="left bottom"><h:commandButton
						value="#{ticTacToe.getFeldValue('2', '0')}"
						action="#{ticTacToe.doAction('2', '0')}"
						styleClass="gameButton #{ticTacToe.isWinnerButton('2', '0')}" 
						rendered="#{ticTacToe.isNotDisabled('2', '0')}" />
						<h:panelGroup rendered="#{ticTacToe.getFeldValue('2', '0') == 'X'}">
							<ui:include src="x.svg" />
						</h:panelGroup>
						<h:panelGroup rendered="#{ticTacToe.getFeldValue('2', '0') == 'O'}">
							<ui:include src="o.svg" />
						</h:panelGroup>
						</td>
				<td class="bottom"><h:commandButton
						value="#{ticTacToe.getFeldValue('2', '1')}"
						action="#{ticTacToe.doAction('2', '1')}"
						styleClass="gameButton #{ticTacToe.isWinnerButton('2', '1')}" 
						rendered="#{ticTacToe.isNotDisabled('2', '1')}" />
						<h:panelGroup rendered="#{ticTacToe.getFeldValue('2', '1') == 'X'}">
							<ui:include src="x.svg" />
						</h:panelGroup>
						<h:panelGroup rendered="#{ticTacToe.getFeldValue('2', '1') == 'O'}">
							<ui:include src="o.svg" />
						</h:panelGroup>
						</td>
				<td class="right bottom"><h:commandButton
						value="#{ticTacToe.getFeldValue('2', '2')}"
						action="#{ticTacToe.doAction('2', '2')}"
						styleClass="gameButton #{ticTacToe.isWinnerButton('2', '2')}" 
						rendered="#{ticTacToe.isNotDisabled('2', '2')}" />
						<h:panelGroup rendered="#{ticTacToe.getFeldValue('2', '2') == 'X'}">
							<ui:include src="x.svg" />
						</h:panelGroup>
						<h:panelGroup rendered="#{ticTacToe.getFeldValue('2', '2') == 'O'}">
							<ui:include src="o.svg" />
						</h:panelGroup>
						</td>
			</tr>
		</table>

		<br />
		<br />
		<h:commandButton value="Abbrechen"
			action="#{ticTacToe.doAction('abbruch')}" />
		
		<br />
		
		<h:commandButton id="refreshPageButton" value="Refresh"
			action="#{ticTacToe.doAction('refresh')}" style="display:none" />
		<h:commandButton id="refreshAjaxButton" value="Refresh" style="display:none" >
			<f:ajax render="spielBeendet myTurn connectionEstablished" />
		</h:commandButton>
		<h:outputText id="spielBeendet" style="display:none" value="#{ticTacToe.spielBeendet}" />
		<h:outputText id="myTurn" style="display:none" value="#{ticTacToe.myTurn}" />
		<h:outputText id="connectionEstablished" style="display:none" value="#{ticTacToe.connectionEstablished}" />


		<h:panelGroup rendered="#{!ticTacToe.spielBeendet}">
			<script type="text/javascript">
				//<![CDATA[
				var myTurn = document.getElementById("myTurn").textContent;
				var connectionEstablished = document.getElementById("connectionEstablished").textContent;
				
				setTimeout(function(){ pageRefreshRequired() }, 1000);
				
				function pageRefreshRequired() {
					
					document.getElementById("refreshAjaxButton").click();
					var spielBeendet = document.getElementById("spielBeendet").textContent;
					var myTurnNeu = document.getElementById("myTurn").textContent;
					var connectionEstablishedNeu = document.getElementById("connectionEstablished").textContent;
					if (spielBeendet == "false") {
							if (myTurn == myTurnNeu && connectionEstablished == connectionEstablishedNeu) {
								setTimeout(function(){ pageRefreshRequired() }, 1000);
							}
							else  {
								pageRefreshStarten();
							}
					}
					else {
						pageRefreshStarten();
					}
				}
				
				function pageRefreshStarten() {
					
					document.getElementById("refreshPageButton").click();
				}
				//]]>
			</script>
		</h:panelGroup>
		
	</h:form>

</h:body>
</html>